<div class="container">

    <div class="row">
        <div>
            <md-button class="md-raised md-accent" ng-click="tracksCtrl.createTrackElement()">
                <md-icon class="material-icons">add</md-icon> Add new Track
            </md-button>
        </div>
        <ul class="tracklist">
            <li ng-repeat="(key,track) in tracksCtrl.tracksArray | orderBy:'starttime':true" class="tracklistelement">
                <form class="track-form" editable-form name="editableForm" onaftersave="tracksCtrl.updateTrack($data, track.$id)" shown="tracksCtrl.newTrack.starttime == track.starttime">
                    <div class="track-inputs">
                        <div class="track-desc-project-tag">
                            <div class="track-desc formgroup">
                                <label for="trackDesc{{key}}" ng-show="editableForm.$visible">Working on...</label>
                                <span e-id="trackDesc{{key}}" editable-text="track.desc" e-name="desc" e-class="form-control">{{track.desc || 'empty'}}</span>
                            </div>
                            <div class="track-project formgroup">
                                <label for="trackProject{{key}}" ng-show="editableForm.$visible">Project</label>
                                <span class="track-project label label-primary" editable-select="track.project" e-name="project" e-class="form-control editable-input"
                                      e-id="trackProject{{key}}" e-ng-change="tracksCtrl.updateProject($data, track.$id)"
                                      e-ng-options="p.$id as p.name for p in tracksCtrl.projectsArray">{{ tracksCtrl.showProject(track.project) }}</span>
                            </div>
                            <div class="track-tag formgroup">
                                <label for="trackTag{{key}}" ng-show="editableForm.$visible">Tag</label>

                                <!--
                                <md-chips ng-hide="editableForm.$visible">
                                    <md-chip ng-repeat="(key,val) in tracksCtrl.showTags(track.project, track.tags).split(', ')">{{ val }}</md-chip>
                                </md-chips>
                                -->

                                <span class="track-tag label label-default" editable-select="track.tags" e-name="tags" e-class="form-control editable-input" e-multiple
                                    e-id="trackTag{{key}}" e-ng-options="t.$id as tracksCtrl.loadTagname(t) for t in tracksCtrl.loadTags(track.project) | orderBy:'name'">
                                    {{ tracksCtrl.showTags(track.project, track.tags) }}</span>
                            </div>
                        </div>

                        <div class="track-date-time-duration">
                            <div class="track-starttime formgroup">
                                <label for="trackStart{{key}}">From</label>
                                <span editable-text="track.starttime" e-name="starttime" e-class="form-control editable-input"
                                      e-id="trackStart{{key}}" e-ng-change="tracksCtrl.changeStarttime($data, track)">
                                    {{ track.starttime | datetimenosecond }}</span>
                            </div>
                            <div class="track-endtime formgroup">
                                <label for="trackEnd{{key}}">To</label>
                                <span editable-text="track.endtime" e-name="endtime" e-class="form-control editable-input"
                                      e-id="trackEnd{{key}}" e-ng-change="tracksCtrl.changeEndtime($data, track)">
                                    {{ track.endtime | datetimenosecond }}</span>
                            </div>
                            <div class="track-difftime formgroup">
                                <label for="trackDiff{{key}}">Duration</label>
                                <span editable-text="track.difftime" e-name="difftime" e-class="form-control editable-input"
                                      e-id="trackDiff{{key}}" e-ng-change="tracksCtrl.changeDifftime($data, track)">
                                    {{(track.difftime | durationmin) || 'no diff time' }}</span>
                            </div>
                        </div>
                    </div>
                    <div class="track-buttons">
                        <span ng-show="!editableForm.$visible">
                            <span ng-hide="confirm">
                                <md-button class="md-raised md-primary" ng-hide="track.record" ng-click="tracksCtrl.recordTrack(track, true)">
                                    <md-icon>timer</md-icon> Start Timer
                                </md-button>
                                <md-button class="md-raised md-accent" ng-show="track.record" ng-click="tracksCtrl.recordTrack(track, false)">
                                    <md-icon>timer_off</md-icon> Stop Timer
                                    <span>{{ track.difftime | durationsec }}</span>
                                </md-button>

                                <md-button class="md-icon-button" type="button" ng-click="tracksCtrl.editTrack(track.project); editableForm.$show()">
                                    <md-icon>mode_edit</md-icon>
                                </md-button>
                                <md-button class="md-icon-button" type="button" ng-click="confirm=true">
                                    <md-icon>delete</md-icon>
                                </md-button>
                            </span>
                            <span ng-show="confirm">
                                <md-button class="md-icon-button md-primary" title="Are you sure? Yes, delete it!" ng-click="tracksCtrl.deleteTrack(track.$id)">
                                    <md-icon>delete</md-icon>
                                </md-button>
                                <md-button class="md-icon-button" title="Are you sure? No, don't delete it!" ng-click="confirm=false">
                                    <md-icon>highlight_off</md-icon>
                                </md-button>
                            </span>
                        </span>

                        <span ng-show="editableForm.$visible">
                            <md-button class="md-icon-button md-primary" type="submit" ng-disabled="editableForm.$waiting">
                                <md-icon>done</md-icon>
                            </md-button>
                            <md-button class="md-icon-button" type="button" ng-disabled="editableForm.$waiting" ng-click="tracksCtrl.cancelTrack(track); editableForm.$cancel()">
                                <md-icon>highlight_off</md-icon>
                            </md-button>
                        </span>
                    </div>
                </form>
            </li>
        </ul>
    </div>
    <hr>

    <div class="footer">
        <p>copyright protrack from protrack</p>
    </div>
</div>
